<div class="flex-container row tool-body">
  <div *ngIf="reports" class="main-tool-body">
    <div class="wrapper" style="height:100%">
      <div class="row" style="width:100%">
        <div class="col">
          <h3>Reports</h3>
        </div>
        <div class="col">
          <input (input)="globalSearch($event)" placeholder="Insert Keywords/Request Number here " class="form-control">
        </div>
        <div class="col">
          <div class="icons">
            <div class="press">
              <button data-toggle="modal" data-target="#helpModal"
                style="background-color:white; border:none;padding-right:0px;">
                <a data-toggle="tooltip" title="HELP"><i id="ic" class="material-icons">help_outline</i></a>
              </button>
              <a (click)="xlsxJson()" style="cursor:pointer"><i id="ic" class="material-icons">get_app</i></a>
            </div>
          </div>
        </div>
      </div>

      <div class="tableFixHead">
        <table class="table table-striped table-hover" *ngIf="reports">
          <thead class="thead">
            <tr>
              <th (click)="sort('favorites')">
                <div>
                  <div class="alignLeft">
                    <div>Favourites</div>
                    <div *ngIf="!reports['favorites']">&#8593;</div>
                    <div *ngIf="reports['favorites']">&#8595;</div>
                  </div>
                </div>
              </th>
              <th>
                <div>
                  <div class="alignLeft" (click)="sort('ddm_rmp_post_report_id')">
                    <div>Request No.</div>
                    <div *ngIf="!reports['ddm_rmp_post_report_id']">&#8593;</div>
                    <div *ngIf="reports['ddm_rmp_post_report_id']">&#8595;</div>
                  </div>
                  <div>
                    <input (input)="columnSearch($event,'ddm_rmp_post_report_id')" placeholder="Enter Request no"
                      class="form-control">
                  </div>
                </div>
              </th>
              <th>
                <div>
                  <div class="alignLeft" (click)="sort('ddm_rmp_status_date')">
                    <div>Date</div>
                    <div *ngIf="!reports['ddm_rmp_status_date']">&#8593;</div>
                    <div *ngIf="reports['ddm_rmp_status_date']">&#8595;</div>
                  </div>
                  <input (input)="columnSearch($event,'ddm_rmp_status_date')" placeholder="Enter Date"
                    class="form-control">
                </div>
              </th>
              <th>
                <div>
                  <div class="alignLeft" (click)="sort('title')">
                    <div>Title</div>
                    <div *ngIf="!reports['title']">&#8593;</div>
                    <div *ngIf="reports['title']">&#8595;</div>
                  </div>
                  <div>
                    <input (input)="columnSearch($event,'title')" placeholder="Enter Title" class="form-control">
                  </div>
                </div>
              </th>
              <th>
                <div>
                  <div class="alignLeft" (click)="sort('report_name')">
                    <div>DDM Name</div>
                    <div *ngIf="!reports['report_name']">&#8593;</div>
                    <div *ngIf="reports['report_name']">&#8595;</div>
                  </div>
                  <div>
                    <input (input)="columnSearch($event,'report_name')" placeholder="Enter DDM Name"
                      class="form-control">
                  </div>
                </div>
              </th>
              <th>
                <div>
                  <div class="alignLeft" (click)="sort('frequency')">
                    <div>Frequency</div>
                    <div *ngIf="!reports['frequency']">&#8593;</div>
                    <div *ngIf="reports['frequency']">&#8595;</div>
                  </div>
                  <div>
                    <input (input)="columnSearch($event,'frequency')" placeholder="Enter Frequency"
                      class="form-control">
                  </div>
                </div>
              </th>
              <th *ngFor="let weekDay of weekDays" (click)="sort(weekDay + 'Frequency')">
                <div style="width: 20px">
                  <div class="alignLeft">
                    {{weekDay}}
                    <span *ngIf="!reports[weekDay + 'Frequency']">&#8593;</span>
                    <span *ngIf="reports[weekDay + 'Frequency']">&#8595;</span>
                  </div>
                </div>
              </th>
              <th>
                <div>Other</div>
              </th>
            </tr>
          </thead>
          <tbody *ngIf="reports">
            <tr
              *ngFor="let element of reports | filterTable: searchObj | orderBy: param:orderType | paginate: { itemsPerPage: 15, currentPage: p }; let i = index">
              <td class="fav" scope="col">
                <div>
                  <label for="{{element.ddm_rmp_post_report_id}}" class="custom-checkbox">
                    <input type="checkbox" [(ngModel)]="element.favorites" id="{{element.ddm_rmp_post_report_id}}"
                      (click)="checked(element.ddm_rmp_post_report_id,$event)" />
                    <i class="material-icons empty">star_border</i>
                    <i class="material-icons star">star</i>
                  </label>
                </div>
              </td>
              <td>
                <div>{{element.ddm_rmp_post_report_id}}</div>
              </td>
              <td>
                <div>{{element.ddm_rmp_status_date}}</div>
              </td>
              <td>
                <div>{{element.title}}</div>
              </td>
              <td class="ddm-report-name" (click)="goToReports(element.report_name,element.title)">
                <div>{{element.report_name}}</div>
              </td>
              <td class="change-freq"
                (click)="changeFreq(element.ddm_rmp_post_report_id,element.title,element.ddm_rmp_status_date)">
                <div>{{element.frequency}}</div>
              </td>
              <td *ngFor="let weekDay of weekDays">
                <div style="width: 20px">{{element[weekDay + 'Frequency']}}</div>
              </td>
              <td *ngIf="element.frequency_data || element.description">
                <div>
                  <span *ngFor="let subelement of element.frequency_data_filtered">{{subelement}} <br></span>
                  {{element.description}}
                </div>
              </td>
              <td *ngIf="!element.frequency_data && !element.description">

              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div style="padding-top: 0.7%;">
        <pagination-controls (pageChange)="p = $event"></pagination-controls>
      </div>

    </div>
  </div>
  <div class="main-tool-body" *ngIf="!reports">
    <mat-progress-spinner style="left:40%;top:40%;" mode="indeterminate"></mat-progress-spinner>
  </div>

  <div id="configReport" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Configurable DDM Report</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body modal-comment-body">
          <div class="row config">
            <div class="col-sm-5">
              Request No.
            </div>
            <div class="col-sm-7">
              2018-2016
            </div>
          </div>

          <div class="row config">
            <div class="col-sm-5">
              Title:
            </div>
            <div class="col-sm-7">
              Order-to-Sale
            </div>
          </div>

          <div class="row config">
            <div class="col-sm-5">
              DDM Name:
            </div>
            <div class="col-sm-7">
              NC Allocation Group-Units in Stock
            </div>
          </div>

          <div class="row config">
            <div class="col-sm-5">
              Division(s):
            </div>
            <div class="col-sm-7">

              <ng-multiselect-dropdown class="drop-" [placeholder]="'Search for model'" [data]="dropdownList"
                [(ngModel)]="selectedItems" [settings]="dropdownSettings" (onSelect)="onItemSelect($event)"
                (onSelectAll)="onSelectAll($event)">
              </ng-multiselect-dropdown>

            </div>
          </div>

          <div class="row config-drop">
            <div class="col-sm-5">
              Allocation Groups(s):
            </div>
            <div class="col-sm-7">

              <ng-multiselect-dropdown class="drop-" [placeholder]="'Search for model'" [data]="dropdownList"
                [(ngModel)]="selectedItems" [settings]="dropdownSettings" (onSelect)="onItemSelect($event)"
                (onSelectAll)="onSelectAll($event)">
              </ng-multiselect-dropdown>

            </div>
          </div>

        </div>
        <div class="modal-footer">
          <div class="col-sm-6">
            <button type="button" class="btn btn-primary  footer-buttons">Create Report</button>
          </div>
          <div class="col-sm-6">
            <button type="button" class="btn btn-success">Save Settings</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="modal fade " id="helpModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header" style="justify-content: flex-start;">
          <img class="logo" src="/assets/OFT_Logo.jpg">
          <h5 class="modal-title help-title">Help</h5>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-9">
              <button class="btn btn-success save-text-ddm" (click)="content_edits()" *ngIf="editModes"
                style="margin-right:3%">Save</button>
              <button class="btn btn-danger save-text-ddm" (click)="edit_True()" *ngIf="editModes">Cancel</button>
            </div>
            <div class="col-3" style="padding-left:12%;">
              <button *ngIf="user_role == 'Admin'" id="edit_button" class="editButton" (click)="edit_True()"
                style="background-color:white;border: none;">
                <a data-toggle="tooltip" title="EDIT"><i id="ic" class="material-icons">mode_edit</i></a>
              </button>
            </div>
          </div>
          <div id="ckEditorHelp"></div>
        </div>
        <div class="modal-footer">
          <button type="button" id="modal_close_button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <app-ondemand-reports [requestNumber]="reportRequestNumberOD" [reportId]="reportIdOD"
    (odScheduleConfirmation)="startOnDemandScheduling($event)"></app-ondemand-reports>
  <app-ondemand-config-reports [requestNumber]="reportRequestNumber" [title]="reportTitle" [name]="reportName"
    [reportId]="reportId" (odcScheduleConfirmation)="startOnDemandScheduling($event)"></app-ondemand-config-reports>

  <div id="change-Frequency" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header" style="justify-content: flex-start;">
          <h3 class="modal-title">Change Frequency</h3>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" style="overflow-y: hidden;max-height: 510px;">
          <div class="row">
            <div class="col-sm-3">
              <p><b>Request No. : </b></p>
              <p><b>Title : </b></p>
              <p><b>Date : </b></p>
            </div>
            <div class="col-sm-8">
              <p><b>{{changeFreqId}}</b></p>
              <p><b>{{changeFreqTitle}}</b></p>
              <p><b>{{changeFreqDate}}</b></p>
            </div>
          </div>
          <br>
          <br>
          <div class="col-sm-12">
            <div class="card">
              <div class="card-header">
                Select Frequency for Ongoing Routine Reports
              </div>
              <div class="card-body top-padding">
                <!--------------------------- Select Report Frequency------------------->
                <span><i><strong><u>
                        Frequency for Vehicle Events Status Requests
                      </u></strong></i></span>

                <div class="row" *ngFor="let element of obj_keys;let i = index">
                  <div class="time-check col-sm-8 " [id]="'section'+i">
                    <div data-toggle="collapse" [attr.data-target]="'#'+'drop'+i" class="timing day" type="radio"
                      name="dates" [id]="'check'+i" (change)="toggle_freq_selections(i)"
                      style="cursor:pointer; margin-top: 2%" #frequency_selections>&nbsp;&nbsp;{{element}}</div>
                  </div>
                  <div class="time-options col-sm-4">
                    <button class="down-arrow" data-toggle="collapse" [attr.data-target]="'#'+'drop'+i"
                      aria-expanded="false" [attr.aria-controls]="'drop'+i">
                      <svg class="sv" style="width:24px;height:24px">
                        <path fill="#000000" d="M7,10L12,15L17,10H7Z" />
                      </svg>
                    </button>
                  </div>
                  <div class="collapse in" [id]="'drop'+i">
                    <div *ngFor="let element of freq_val; let j =  index">
                      <div *ngIf="i==j">
                        <div *ngFor="let subelement of element; let z=index">
                          <div *ngIf="subelement.select_frequency_description == false">
                            &nbsp;&nbsp;
                            <input id=check{{subelement.ddm_rmp_lookup_select_frequency_id}} class="sub" type="checkbox"
                              (click)="frequencySelected(subelement,$event)"
                              value={{subelement.ddm_rmp_lookup_select_frequency_id}}
                              [id]="'expand'+i">&nbsp;&nbsp;{{subelement.select_frequency_values}}
                          </div>
                          <div *ngIf="subelement.select_frequency_description == true">
                            &nbsp;&nbsp;
                            <input id=check{{subelement.ddm_rmp_lookup_select_frequency_id}} class="sub" type="checkbox"
                              (click)="frequencySelectedDropdown(subelement,$event)"
                              value={{subelement.ddm_rmp_lookup_select_frequency_id}}
                              [id]="'expand'+i">&nbsp;&nbsp;{{subelement.select_frequency_values}}
                            <br>
                            &nbsp;&nbsp; &nbsp;&nbsp;
                            <input id=drop{{subelement.ddm_rmp_lookup_select_frequency_id}} class="sub-freq"
                              (blur)=getSpecifyContent(subelement.ddm_rmp_lookup_select_frequency_id,$event) type="text"
                              value="">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <br>
                <span><i><strong><u>
                        Frequency for Dealer Allocation Requests
                      </u></strong></i></span>
                <div class="row" *ngFor="let element of obj_keys_da;let i = index">
                  <div class="time-check col-sm-8 " [id]="'section'+i">
                    <div data-toggle="collapse" [attr.data-target]="'#'+'drops'+i" class="timing day" type="radio"
                      name="dates" [id]="'check'+i" (change)="toggle_freq_selections(i)"
                      style="cursor:pointer; margin-top: 2%" #frequency_selections>&nbsp;&nbsp;{{element}}</div>
                  </div>
                  <div class="time-options col-sm-4">
                    <button class="down-arrow" data-toggle="collapse" [attr.data-target]="'#'+'drops'+i"
                      aria-expanded="false" [attr.aria-controls]="'drops'+i">
                      <svg class="sv" style="width:24px;height:24px">
                        <path fill="#000000" d="M7,10L12,15L17,10H7Z" />
                      </svg>
                    </button>
                  </div>
                  <div class="collapse in" [id]="'drops'+i">
                    <div *ngFor="let element of freq_val_da; let j =  index">
                      <div *ngIf="i==j">
                        <div *ngFor="let subelement of element; let z=index">
                          <div *ngIf="subelement.select_frequency_description == false">
                            &nbsp;&nbsp;
                            <input id=check{{subelement.ddm_rmp_lookup_select_frequency_id}} class="sub" type="checkbox"
                              (click)="frequencySelected(subelement,$event)"
                              value={{subelement.ddm_rmp_lookup_select_frequency_id}}
                              [id]="'expand'+i">&nbsp;&nbsp;{{subelement.select_frequency_values}}
                          </div>
                          <div *ngIf="subelement.select_frequency_description == true">
                            &nbsp;&nbsp;
                            <input id=check{{subelement.ddm_rmp_lookup_select_frequency_id}} class="sub" type="checkbox"
                              (click)="frequencySelectedDropdown(subelement,$event)"
                              value={{subelement.ddm_rmp_lookup_select_frequency_id}}
                              [id]="'expand'+i">&nbsp;&nbsp;{{subelement.select_frequency_values}}
                            <br>
                            &nbsp;&nbsp; &nbsp;&nbsp;
                            <input id=drop{{subelement.ddm_rmp_lookup_select_frequency_id}}
                              (blur)=getSpecifyContent(subelement.ddm_rmp_lookup_select_frequency_id,$event) type="text"
                              value="">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <br>
              </div>
            </div>
            <br>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success">Save changes</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>