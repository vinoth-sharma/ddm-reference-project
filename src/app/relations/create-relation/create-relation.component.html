<div class="modal-container">
  <div class="modal-header">
    Create New Relation
    <mat-icon style="cursor:pointer;" (click)="onNoClick();">close</mat-icon>
  </div>
  <div class="modal-body">
    <form #relationsForm="ngForm">
    <mat-form-field>
      <mat-label>Select Left Table</mat-label>
      <mat-select [(ngModel)]="leftTable" name="leftTable" (selectionChange)="setSelectedTable(leftTableId, 'left')" required>
        <!-- <input matInput placeholder="search Column" class= "filter-input" (input)="filterKey($event.target.value,rowIndex,'primary')"/> -->
        <mat-option *ngFor="let table of tables" [value]="table" [hidden]="!table.view_to_admins" title="{{table.mapped_table_name}}">
          {{table.mapped_table_name}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="p-left">
      <mat-label>Select Join</mat-label>
      <mat-select [(ngModel)]="joinKey" name="join" (selectionChange)="setSelectedJoin(selected, 'left')" required>
        <mat-option *ngFor="let join of joins" [value]="join" title="{{join}}">
          {{join}}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field class="p-left">
      <mat-label>Select Right Table</mat-label>
      <mat-select [(ngModel)]="rightTable" name="rightTable" (selectionChange)="setSelectedTable(rightTable, 'right')" required>
        <!-- <input matInput placeholder="search Column" [hidden]="!table.view_to_admins" class= "filter-input" (input)="filterKey($event.target.value,rowIndex,'primary')"/> -->
        <mat-option *ngFor="let table of tables" [value]="table" title="{{table.mapped_table_name}}">
          {{table.mapped_table_name}}
        </mat-option>
      </mat-select>
    </mat-form-field>

     <div *ngFor="let key of keys; index as i; last as isLastKey; first as isFirstKey">
     <!-- <mat-grid-tile> -->

        <mat-form-field>
          <mat-label>Select Primary Key</mat-label>
          <mat-select [(ngModel)]="key.primaryKey" name="primaryKey-{{i}}" (selectionChange)="setSelectedColumn(key, 'primary')" required>
            <!-- <input matInput placeholder="search Column" [hidden]="!table.view_to_admins" class= "filter-input" (input)="filterKey($event.target.value,rowIndex,'primary')"/> -->
            <mat-option *ngFor="let column of leftTable['column_properties'];" [value]="column['column']" title="{{column['data_type']}}">
              {{column['column']}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="p-left">
          <mat-label>Select Value</mat-label>
          <mat-select [(ngModel)]="key.value" name="value-{{i}}" (selectionChange)="setSelectedColumn(key, 'primary')" required>
            <!-- <input matInput placeholder="search Column" [hidden]="!table.view_to_admins" class= "filter-input" (input)="filterKey($event.target.value,rowIndex,'primary')"/> -->
            <mat-option *ngFor="let value of values" [value]="value" title="{{value}}">
              {{value}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="p-left">
          <mat-label>Select Primary Key</mat-label>
          <mat-select [(ngModel)]="key.foriegnKey" name="foriegnKey-{{i}}" (selectionChange)="setSelectedColumn(key, 'primary')" required>
            <!-- <input matInput placeholder="search Column" [hidden]="!table.view_to_admins" class= "filter-input" (input)="filterKey($event.target.value,rowIndex,'primary')"/> -->
            <mat-option *ngFor="let column of rightTable['column_properties'];" [value]="column['column']" title="{{column['data_type']}}">
              {{column['column']}}
            </mat-option>
          </mat-select>
        </mat-form-field>


        <button mat-stroked-button mat-icon-button isRoundButton="true" aria-label="Add Key" (click)="addRow()"
        *ngIf="isLastKey" [disabled]="!(key.primaryKey && key.value && key.foriegnKey) || diffDataType" class="m-left">
        <mat-icon>add</mat-icon>
      </button>

      <button mat-stroked-button mat-icon-button aria-label="Delete join" class="m-left" isRoundButton="true"
       (click)="deleteRow(i)" [disabled]="checkOneRelation()">
        <mat-icon>delete</mat-icon>
      </button>

    </div>
  </form>
  </div>
  <div class="modal-footer">
    <button mat-raised-button style="margin-right: 20px;" (click)="onNoClick();">Cancel</button>
    <button mat-raised-button (click)="showRelationships()">Show</button>
    <button mat-raised-button (click)="onCreate()" [disabled]="relationsForm.form.invalid || diffDataType">
      <span *ngIf="type == 'create'">Create</span>
      <span *ngIf="type == 'edit'">Update</span>
    </button>
  </div>
</div>