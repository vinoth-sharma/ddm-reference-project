<mat-card *ngFor="let item of groupByData; index as i; last as isLast; first as isFirst">
  
  <mat-grid-list cols="4" rowHeight="4:1" *ngIf="isLast">
    <mat-grid-tile colspan="4">
      <form style="display: flex; flex-direction: column; height: 100%; width:100%">
        <mat-form-field class="stretch-height">
          <mat-label>Level of aggregation</mat-label>
          <textarea matInput id="aggregatedColumnsTokenCompulsoryId" rows="4" [formControl]="queryTextareaCompulsory" 
            (change)="calculateFormula(i)" (input)="inputValueCompulsory($event.target.value,i)" 
              [(ngModel)]="aggregatedColumnsTokenCompulsory" [matAutocomplete]="autoCompulsory">
          </textarea>
          <mat-autocomplete #autoCompulsory="matAutocomplete"
           (optionSelected)="onSelectionChangedCompulsory($event)"
           >
            <mat-optgroup *ngFor="let option of (showlevelAggSearchResult?results:[]) " [label]="option.groupName">
              <mat-option *ngFor="let opt of (showlevelAggSearchResult?option.values:[])" [value]="opt">
                {{opt}}
              </mat-option>
            </mat-optgroup>
          </mat-autocomplete>
          <!-- <p *ngIf="isError">Bracket is required</p> -->
          <mat-error *ngIf="!queryTextareaCompulsory.valid">Duplicate Formula!</mat-error>
        </mat-form-field>
      </form>
    </mat-grid-tile>
    <!-- <mat-error *ngIf="showSpacesError"> Please remove unwanted white spaces! </mat-error> -->
  </mat-grid-list>
<!-- 
  <mat-grid-list cols="4" rowHeight="4:1" *ngIf="isLast">
      <mat-grid-tile colspan="4">
        <form style="display: flex; flex-direction: column; height: 100%; width:100%">
          <mat-form-field class="stretch-height">
            <mat-label>Aggregation function for numeric columns</mat-label>
            <textarea matInput rows="4" [formControl]="queryTextarea" (change)="calculateFormula(i)"
              (input)="inputValue($event.target.value,i)" [(ngModel)]="aggregatedColumnsToken"
              [matAutocomplete]="auto">
            </textarea>
            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelectionChanged($event)">
              <mat-optgroup *ngFor="let option of (showlevelAggSearchResult?results:[])" [label]="option.groupName">
                <mat-option *ngFor="let opt of (showlevelAggSearchResult?option.values:[])" [value]="opt">
                  {{opt}}
                </mat-option>
              </mat-optgroup>
            </mat-autocomplete>
            
            <mat-error *ngIf="!queryTextarea.valid">Duplicate Formula!</mat-error>
          </mat-form-field>
        </form>
      </mat-grid-tile>
    </mat-grid-list> -->
    <!-- <p *ngIf="isError">Bracket is required</p> -->

    <mat-grid-list cols="4" rowHeight="4:1" *ngIf="isLast">
      <mat-grid-tile colspan="4">
        <form style="display: flex; flex-direction: column; height: 100%; width:100%">
          <mat-form-field class="stretch-height">
            <mat-label>Conditions for Aggregated columns</mat-label>
            <textarea matInput rows="4" [formControl]="queryConditions" (change)="calculateCondition()" (input)="inputHavingValue($event.target.value,i)" 
               [(ngModel)]="aggregatedConditions"
              [matAutocomplete]="autoConditions">
            </textarea>
            <mat-autocomplete #autoConditions="matAutocomplete" (optionSelected)="onChanges($event)">
              <mat-optgroup *ngFor="let data of results " [label]="data.groupName">
                <mat-option *ngFor="let options of data.values " [value]="options">
                  {{options}}
                </mat-option>
              </mat-optgroup>
            </mat-autocomplete>
          </mat-form-field>
        </form>
      </mat-grid-tile>
      <!-- <mat-error *ngIf="showSpacesErrorHaving"> Please remove unwanted white spaces! </mat-error> -->
    </mat-grid-list>

</mat-card>

<button mat-button matStepperPrevious class="btn btn-primary">Back</button>
<button mat-button matStepperNext (click)="apply();populateSendingData(selectedTables);submitConditions()"
  class="float-right btn btn-success" [disabled]="(!aggregatedColumnsTokenCompulsory && !aggregatedColumnsToken) && fieldsPristine">Add to Formula Bar</button>
  <!-- !aggregatedConditions &&  -->
  <!-- && !showSpacesError && !showSpacesErrorHaving -->
  <!-- && latest value was not empty --> 
<!-- [disabled]="(!aggregatedConditions.length || !aggregatedColumnsTokenCompulsory.length || !aggregatedColumnsToken.length || previousDatObj.select.aggregations.length == 0) || (!aggregatedConditions.length && !aggregatedColumnsTokenCompulsory.length && !aggregatedColumnsToken.length)" -->