<div id="select-tables-wrapper" class="container-fluid">

  <div *ngIf="joins.length">
    <div class="row" *ngFor="let join of joins; index as rowIndex; last as isLast">
      <div class="col-md-3 inline-col">
        <div class="form-group" *ngIf="join['table1'].table">
          <label for="tables-{{rowIndex}}">Select table/custom table</label>
          <select class="form-control" id="tables-{{rowIndex}}" [(ngModel)]="join['table1'].table.mapped_table_name"
            disabled>
            <optgroup label="Tables" [hidden]="isRelated">
              <option *ngFor="let table of tables['tables']" [ngValue]="table.mapped_table_name">
                {{table.mapped_table_name}}</option>
            </optgroup>
            <optgroup label="Custom Tables" [hidden]="isRelated">
              <option *ngFor="let table of tables['custom tables']" [ngValue]="table.custom_table_name">
                {{table.custom_table_name}}
              </option>
            </optgroup>
            <optgroup label="Related Tables" [hidden]="!isRelated">
              <option *ngFor="let table of tables['related tables']" [ngValue]="table.mapped_table_name">
                {{table.mapped_table_name}}
              </option>
            </optgroup>
          </select>
        </div>
      </div>

      <div class="col-md-3 offset-md-1 inline-col" *ngIf="join['table1'].table">
        <label for="columns">Select column</label>
        <ng-multiselect-dropdown [disabled]="true" [data]="join['table1'].table.mapped_column_name"
          [(ngModel)]="join['table1'].columns" [settings]="columnDropdownSettings">
        </ng-multiselect-dropdown>
      </div>

      <div class="w-100"></div>

      <div class="col-md-3 inline-col">
        <div class="form-group" *ngIf="join['table2'].table">
          <label for="tables-{{rowIndex}}">Select table/custom table</label>
          <select class="form-control" id="tables-{{rowIndex}}" [(ngModel)]="join['table2'].table.mapped_table_name"
            disabled>
            <optgroup label="Tables" [hidden]="isRelated">
              <option *ngFor="let table of tables['tables']" [ngValue]="table.mapped_table_name">
                {{table.mapped_table_name}}</option>
            </optgroup>
            <optgroup label="Custom Tables" [hidden]="isRelated">
              <option *ngFor="let table of tables['custom tables']" [ngValue]="table.custom_table_name">
                {{table.custom_table_name}}
              </option>
            </optgroup>
            <optgroup label="Related Tables" [hidden]="!isRelated">
              <option *ngFor="let table of tables['related tables']" [ngValue]="table.mapped_table_name">
                {{table.mapped_table_name}}
              </option>
            </optgroup>
          </select>
        </div>
      </div>

      <div class="col-md-3 offset-md-1 inline-col" *ngIf="join['table2'].table">
        <label for="columns">Select column</label>
        <ng-multiselect-dropdown [disabled]="true" [data]="join['table2'].table.mapped_column_name"
          [(ngModel)]="join['table2'].columns" [settings]="columnDropdownSettings">
        </ng-multiselect-dropdown>
      </div>

      <div class="col-md-1 offset-md-1 text-center px-0 inline-col">
        <div class="form-group" *ngIf="join['id']">
          <select class="form-control" disabled [(ngModel)]="join.type" id="join['id']">
            <option selected disabled value="">Join</option>
            <option value="left">Left</option>
            <option value="right">Right</option>
            <option value="inner">Inner</option>
            <option value="outer">Outer</option>
          </select>
        </div>
      </div>
      <hr class="w-100" *ngIf="!isLast">
    </div>
  </div>

  <!--selectedTables-->
  <div *ngIf="!joins.length">
    <div class="form-group">
      <label for="tables-{{rowIndex}}">Select type of report</label>
      <select class="form-control" id="tables-{{rowIndex}}" [(ngModel)]="reportType" (change)="setReport()">
        <option selected disabled value="">Select type of report</option>
        <option value="1 table">1 table</option>
        <option value="1 join">1 join</option>
        <option value="2 joins">2 joins</option>
        <option value="1 join and 1 table">1 join and 1 table</option>
      </select>
    </div>

    <div *ngIf="reportType">
      <div class="row" *ngFor="let selected of selectedTables; index as rowIndex; last as isLast">
        <div class="col-md-3 inline-col">
          <div class="form-group">
            <label for="tables-{{rowIndex}}">Select table/custom table</label>
            <select class="form-control" id="tables-{{rowIndex}}" [(ngModel)]="selected.table"
              (change)="getRelatedTables(selected)">
              <optgroup label="Tables" [hidden]="isRelated">
                <option *ngFor="let table of tables['tables']" [ngValue]="table">{{table.mapped_table_name}}</option>
              </optgroup>
              <optgroup label="Custom Tables" [hidden]="isRelated">
                <option *ngFor="let table of tables['custom tables']" [ngValue]="table">{{table.custom_table_name}}</option>
              </optgroup>
              <optgroup label="Related Tables" [hidden]="!isRelated">
                <option *ngFor="let table of tables['related tables']" [ngValue]="table">{{table.mapped_table_name}}</option>
              </optgroup>
            </select>
          </div>
        </div>

        <div class="col-md-1 text-center px-0 inline-col">
          <div *ngIf="selected.table && selected.columns.length && isLast && (selectedTables.length < noOfTables)">
            <button type="button" *ngIf="isRelated" class="btn btn-sm btn-secondary add" (click)="addRow()">
              <i class="fa fa-plus" aria-hidden="true"></i>
            </button>
            <button type="button" *ngIf="!isRelated" class="btn btn-sm btn-secondary" (click)="addRow()">
              New Item
            </button>
          </div>
        </div>

        <div class="col-md-3 inline-col" *ngIf="selected.table">
          <label for="columns">Select column</label>
          <ng-multiselect-dropdown [data]="selected['table']['mapped_column_name']" [(ngModel)]="selected.columns"
            [settings]="columnDropdownSettings" (onSelect)="setRelated()">
          </ng-multiselect-dropdown>
        </div>

        <div class="col-md-1 text-center px-0 inline-col">
          <div class="form-check form-check-inline mt-5" *ngIf="selected.table && selected.columns.length">
            <input class="form-check-input" type="checkbox" id="checkbox-{{rowIndex}}" [checked]="selected.checked"
              (change)="createJoin(selected, $event.target.checked)">
            <label class="form-check-label" for="checkbox-{{rowIndex}}"></label>
          </div>
        </div>

        <div class="col-md-1 text-center px-0 inline-col"
          *ngIf="(currentJoin['tables'].length === 2) && (selected === selectedTables[1])">
          <div class="form-group">
            <select class="form-control" [(ngModel)]="currentJoin.type" (change)="createJoin(selected)">
              <option selected disabled value="">Join</option>
              <option value="left">Left</option>
              <option value="right">Right</option>
              <option value="inner">Inner</option>
              <option value="outer">Outer</option>
            </select>
          </div>
        </div>
        <hr class="w-100" *ngIf="!isLast">
      </div>
    </div>
  </div>

</div>