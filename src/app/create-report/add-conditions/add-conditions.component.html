<mat-card>
  <mat-accordion>
    <mat-expansion-panel style="margin-bottom: 15px;">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <b>Choose existing conditions</b>
        </mat-panel-title>
        <mat-panel-description> </mat-panel-description>
      </mat-expansion-panel-header>
       <mat-grid-list cols="2" rowHeight="30px" *ngIf="condition.length"> -
         <mat-grid-list cols="2" rowHeight="30px">
        <mat-grid-tile [colspan]="1">
          <mat-form-field style="width: 100%">
            <input matInput type="text" placeholder="Search for condition(s)" (input)="filterList($event.target.value)">
          </mat-form-field>
        </mat-grid-tile>
      </mat-grid-list>
      <section *ngFor="let item of condition">
        <mat-checkbox style="font-weight: normal;" id="{{item.condition_id}}" class="checkobox" [checked]="item.checked"
          (change)="onSelect(item.condition_name, item.condition_id, $event, item)">{{item.condition_name}}
        </mat-checkbox> -->

        <!-- <button class="mini-fab sideButtons" *ngIf="condition.length" title="Delete Permanently"
          (click)="deleteCondition(item.condition_id)">
          <i class="material-icons" style="color:#afafb5">
            delete
          </i>
        </button> -->
      <!-- </section> -->
      <p *ngIf="!condition.length" style="text-align: center;">No Data Available</p>
    </mat-expansion-panel>
  </mat-accordion>

  <mat-card>
    <mat-card-header>
      <b style="margin-left: -24px;">Define New Condition</b></mat-card-header>
    <table class="table">
      <thead style="width:100%;">
        <tr>
          <th class="text-center" *ngFor="let h of headers" scope="col">
            <b>{{h}}</b>
          </th>
          <button class="sideButtons" *ngIf="createFormula.length == 0" (click)="addColumnBegin()" title="Add row">
            <i class="material-icons" style="color:#afafb5;">
              add_circle
            </i>
          </button>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let con of createFormula;let i = index;">
          <td width="5%">
            <input type="text" class="brackets" (keypress)="checkOpen($event)" [(ngModel)]="con['open']" />
          </td>
          <td width="20%">
            <select required class="dropdown" [(ngModel)]="con.table" (change)="onTableSelection($event, con)">
              <option class="text-center" *ngFor="let item of tables" [value]="item.alias">{{item.name}}</option>
            </select>
          </td>
          <td width="20%">
            <select required class="dropdown" [(ngModel)]="con.attributes">
              <option class="text-center" *ngFor="let column of con.columns" [ngValue]="column">{{column}}</option>
            </select>
          </td>
          <td width="10%">
            <select required class="dropdown" [(ngModel)]="con.condition">
              <option class="text-center" *ngFor="let x of conditionList" [ngValue]="x">{{x}}</option>
            </select>
          </td>
          <td width="30%">
            <div style="display:inline-block;">
              <input type="text" class="textarea" style="border-color: #afafb5;width: 263px;" rows="1"
                [(ngModel)]="con.values" />
              <!-- <button class="sideButtons" style="margin-top:3px;" title="Parameters" (click)="fetchParameters()">
                <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                  <path fill="#afafb5"
                    d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,10.5A1.5,1.5 0 0,0 10.5,12A1.5,1.5 0 0,0 12,13.5A1.5,1.5 0 0,0 13.5,12A1.5,1.5 0 0,0 12,10.5M6.5,10.5A1.5,1.5 0 0,0 5,12A1.5,1.5 0 0,0 6.5,13.5A1.5,1.5 0 0,0 8,12A1.5,1.5 0 0,0 6.5,10.5M17.5,10.5A1.5,1.5 0 0,0 16,12A1.5,1.5 0 0,0 17.5,13.5A1.5,1.5 0 0,0 19,12A1.5,1.5 0 0,0 17.5,10.5Z" />
                </svg>
              </button> -->
              <input type="file" style="display: none;" accept=".xls,.xlsx" id="valueInput{{i}}"
                (click)="uploadFile($event,con,i)">
              <button class="sideButtons" (click)="triggerFileBtn(i)" style="margin-top:3px;" title="Upload excel">
                <svg style="width:24px;height:24px;" viewBox="0 0 24 24">
                  <path fill="#afafb5" d="M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z" />
                </svg>
              </button>
            </div>
          </td>
          <td width="5%">
            <input type="text" class="brackets" (keypress)="checkClose($event)" [(ngModel)]="con['close']" />
          </td>
          <td width="3%" style="border-width: 0px;">
            <select required class="dropdown" [(ngModel)]="con.operator">
              <option class="text-center" *ngFor="let x of operator" [ngValue]="x == '-'? '': x">{{x}}</option>
            </select>
          </td>
          <div style="display:inline-block">
            <button class="sideButtons" style="margin-left: -13px;" (click)="addColumn(con)" title="Add row">
              <i class="material-icons" style="color:#afafb5;font-size: 18px;">
                add_circle
              </i>
            </button>
            <!-- <button *ngIf="createFormula.length >= 2" class="sideButtons" title="Reset row" (click)="removeColumn(con)"> -->
            <button class="sideButtons" title="Remove row" (click)="removeColumn(con)">
              <i class="material-icons" style="color:#afafb5;font-size: 18px;margin-left: -11px;">
                remove_circle
              </i>
            </button>
          </div>
        </tr>
      </tbody>
    </table>
  </mat-card>
  <mat-card>
    <!-- <mat-card-header>
      <b style="margin-left:-33px;">Condition Formula:</b> </mat-card-header>
      <span *ngFor="let i of createFormula">{{i.open}}{{i.table}}.{{i.attributes}}{{i.condition}}{{i.values}}&nbsp;{{i.close}}&nbsp;{{i.operator}}</span> -->
    <form #saveForm="ngForm" style="display: flex; flex-direction: column; height: 50%;">
      <mat-form-field class="stretch-height">
        <mat-label>Save as:</mat-label>
        <textarea matInput [(ngModel)]="columnName" name="columnName"></textarea>
      </mat-form-field>
    </form>
    <!-- <mat-card-actions> -->
    <!-- <button mat-raised-button color="primary" (click)="defineFormula()">Apply</button> -->
    <!-- </mat-card-actions> -->
  </mat-card>
  <form style="display: flex; flex-direction: column; height: 50%;">
      <mat-form-field class="stretch-height">
        <mat-label>Enter Formula</mat-label>
        <textarea
          matInput
          [formControl]="queryTextarea" (input)="inputValue($event.target.value)"
          [matAutocomplete]="auto"
        ></textarea>
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelectionChanged($event)" >
            <mat-optgroup *ngFor="let option of results " [label]="option.groupName">
              <mat-option *ngFor="let opt of option.values " [value]="opt">
                {{opt}}
              </mat-option>
            </mat-optgroup>
          </mat-autocomplete>
        <p *ngIf="isError">Bracket is required</p>
        <mat-error *ngIf="!queryTextarea.valid">Duplicate Formula!</mat-error>
      </mat-form-field>
    </form>
</mat-card>
<button mat-button matStepperPrevious>Back</button>
<button mat-button matStepperNext (click)="defineFormula()" class="float-right">Finish</button>