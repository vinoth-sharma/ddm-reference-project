<div class="modal-container">
  <div class="modal-header">
    Create New Relation
    <mat-icon class="pointer" (click)="onNoClick();">close</mat-icon>
  </div>
  <div class="modal-body">
    <form #relationsForm="ngForm">
      <mat-form-field>
        <mat-label>Select Left Table</mat-label>
        <mat-select [(ngModel)]="leftTable" name="leftTable" (selectionChange)="setSelectedTable(leftTable, 'left')" required>
          <!-- <mat-option *ngFor="let table of tables" [value]="table['sl_tables_id']" [hidden]="!table.view_to_admins" title="{{table.mapped_table_name}}">
            {{table.mapped_table_name}}
          </mat-option> -->

          <mat-optgroup label="Tables" [hidden]="!tables['tables'].length">
            <mat-option *ngFor="let table of tables['tables']" [value]="table['sl_tables_id']" title="{{table.mapped_table_name | uppercase}}">
              {{table.mapped_table_name | uppercase}}
            </mat-option>
          </mat-optgroup>
          <mat-optgroup label="Custom Tables" [hidden]="!tables['customTables'].length">
            <mat-option *ngFor="let table of  tables['customTables']" [value]="table['custom_table_id']" title="{{table.custom_table_name | uppercase}}">
              {{table.custom_table_name | uppercase}}
            </mat-option>
          </mat-optgroup>
          
        </mat-select>
      </mat-form-field>
      <mat-form-field class="p-left">
        <mat-label>Select Join</mat-label>
        <mat-select [(ngModel)]="joinKey" name="join" required>
          <mat-option *ngFor="let join of joins" [value]="join" title="{{join}}">
            {{join}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="p-left">
        <mat-label>Select Right Table</mat-label>
        <mat-select [(ngModel)]="rightTable" name="rightTable" (selectionChange)="setSelectedTable(rightTable, 'right')" required>
          <!-- <mat-option *ngFor="let table of tables" [value]="table['sl_tables_id']" title="{{table.mapped_table_name}}">
            {{table.mapped_table_name}}
          </mat-option> -->

          <mat-optgroup label="Tables" [hidden]="!tables['tables'].length">
            <mat-option *ngFor="let table of tables['tables']" [value]="table['sl_tables_id']" title="{{table.mapped_table_name | uppercase}}">
              {{table.mapped_table_name | uppercase}}
            </mat-option>
          </mat-optgroup>
          <mat-optgroup label="Custom Tables" [hidden]="!tables['customTables'].length">
            <mat-option *ngFor="let table of  tables['customTables']" [value]="table['custom_table_id']" title="{{table.custom_table_name | uppercase}}">
              {{table.custom_table_name | uppercase}}
            </mat-option>
          </mat-optgroup>

        </mat-select>
      </mat-form-field>
      <div *ngFor="let key of keys; index as i; last as isLastKey; first as isFirstKey">
        <mat-form-field>
          <mat-label>Select Primary Key</mat-label>
          <mat-select [(ngModel)]="key.primaryKey" name="primaryKey-{{i}}" (selectionChange)="setSelectedColumn(key, 'primary')" required>
            <mat-option *ngFor="let column of LeftColumns;" [value]="column['column']" title="{{column['data_type']}}">
              {{column['column']}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="p-left">
          <mat-label>Select operator</mat-label>
          <mat-select [(ngModel)]="key.operator" name="operator-{{i}}" required>
            <mat-option *ngFor="let operator of operators" [value]="operator" title="{{operator}}">
              {{operator}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="p-left">
          <mat-label>Select Primary Key</mat-label>
          <mat-select [(ngModel)]="key.foriegnKey" name="foriegnKey-{{i}}" (selectionChange)="setSelectedColumn(key, 'primary')" required>
            <mat-option *ngFor="let column of rightColumns" [value]="column['column']" title="{{column['data_type']}}">
              {{column['column']}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <button mat-stroked-button mat-icon-button isRoundButton="true" aria-label="Add Key" (click)="addRow()" *ngIf="isLastKey" [disabled]="!(key.primaryKey && key.operator && key.foriegnKey) || diffDataType" class="m-left">
          <mat-icon>add</mat-icon>
        </button>
        <button mat-stroked-button mat-icon-button aria-label="Delete join" class="m-left" isRoundButton="true" (click)="deleteRow(i)" [disabled]="checkOneRelation()">
          <mat-icon>delete</mat-icon>
        </button>
        <mat-error *ngIf="key.diffDataType">Primary key and foreign key cannot be of different data types</mat-error>
      </div>

      <div>
        <mat-form-field>
          <mat-label>Name</mat-label>
          <input matInput [(ngModel)]="relation.name" name="relationName"/>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Description</mat-label>
          <input matInput [(ngModel)]="relation.desc" name="relationDesc"/>
        </mat-form-field>

      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button mat-raised-button class="m-right" (click)="showRelationships()">Relations</button>
    <button mat-raised-button (click)="onCreate()" [disabled]="relationsForm.form.invalid || diffDataType">
        <span *ngIf="type == 'create'">Create</span>
        <span *ngIf="type == 'edit'">Update</span>
      </button>
    <button mat-raised-button class="m-right" (click)="onNoClick();">Cancel</button>
  </div>
</div>