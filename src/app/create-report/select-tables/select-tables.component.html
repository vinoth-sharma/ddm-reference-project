<div id="select-tables-wrapper" class="container-fluid">
  <div class="row" *ngFor="let selected of selectedTables; index as rowIndex; last as isLast; first as isFirst">

    <div class="col-md-3" *ngIf="tables['tables'].length || tables['custom tables'].length">
      <div class="form-group">
        <label for="tables-{{rowIndex}}">Select table/custom table</label>
        <select class="form-control" id="tables-{{rowIndex}}" [(ngModel)]="selected.table" [disabled]="selected.disabled"
         (change)="getRelatedTables(selected)">
          <optgroup label="Related Tables" [hidden]="!isRelated">
            <option *ngFor="let table of tables['related tables']" [ngValue]="table">{{table.mapped_table_name | uppercase}}
            </option>
          </optgroup>
          <optgroup label="Tables" *ngIf="tables['tables'].length">
            <option *ngFor="let table of tables['tables']" [ngValue]="table">{{table.mapped_table_name | uppercase}}</option>
          </optgroup>
          <optgroup label="Custom Tables" *ngIf="tables['custom tables'].length">
            <option *ngFor="let table of tables['custom tables']" [ngValue]="table">{{table.custom_table_name | uppercase}}
            </option>
          </optgroup>
        </select>
      </div>
    </div>

    <div class="col-md-1 px-0 text-center">
      <div class="mt-5" *ngIf="selected.table && selected.columns.length && isLast && (selectedTables.length < 2)">
        <button type="button" class="btn btn-sm btn-secondary" (click)="addRow()">
          New Item
        </button>
      </div>
    </div>

    <div class="col-md-3" *ngIf="selected.table">
      <label for="columns">Select column</label>
      <ng-multiselect-dropdown [disabled]="selected.disabled" [data]="selected['table']['mapped_column_name']"
        [(ngModel)]="selected.columns" [settings]="columnDropdownSettings" (onSelect)="onColumnSelect()"
        (onSelectAll)="updateSelectedTables()" (onDeSelect)="updateSelectedTables()">
      </ng-multiselect-dropdown>
    </div>

    <div class="col-md-2 text-center" *ngIf="selected.table && selected.columns.length && !isFirst">
      <div class="form-group mt-5">
        <select class="form-control" [(ngModel)]="selected.join" [disabled]="selected.disabled" (change)="setJoinData()">
          <option selected disabled value="">Select Join</option>
          <option value="left">Left</option>
          <option value="right">Right</option>
          <option value="inner">Inner</option>
          <option value="outer">Outer</option>
        </select>
      </div>
    </div>

    <div class="col-md-1 mt-5 text-center" *ngIf="selected.table && selected.columns.length && isLast">
      <button type="button" class="btn btn-sm btn-secondary delete" (click)="deleteJoin(rowIndex)">
        <svg viewBox="0 0 24 24">
          <path fill="#ffffff" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
        </svg>
      </button>
    </div>

    <div class="col-md-1 mt-5 text-center" *ngIf="selected.table && selected.columns.length && isLast && selected.join && !isFirst && joinData.length">
      <button type="button" class="btn btn-sm btn-secondary" data-toggle="modal" data-target="#setJoin">
        Set Join
      </button>
    </div>

    <hr class="w-100" *ngIf="!isLast">
  </div>
</div>

<app-set-join [tables]="joinData" (onUpdate)="updateSelectedTables()"></app-set-join>