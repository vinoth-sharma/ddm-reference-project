<mat-card *ngFor="let item of aggregationsLevelList; index as i; last as isLast; first as isFirst">
  <mat-grid-list cols="4" rowHeight="4:1">

    <mat-grid-tile>
      <mat-form-field *ngIf="selectedTables && selectedTables.length">
        <mat-label>Select a table</mat-label>
        <mat-select [(ngModel)]="aggregationData.aggregationTable[i]"
          (selectionChange)="onTableSelect(aggregationData.aggregationTable[i], i)">
          <mat-option *ngFor="let table of selectedTables" [value]="table">{{table.table.select_table_name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Level of aggregation</mat-label>
        <mat-select placeholder="Column of level of aggregation(DATE)"
          (selectionChange)="calculateFormula1(i);populateAggregations(aggregationData.aggregationLevelColumns[i], i)"
          [(ngModel)]="aggregationData.aggregationLevelColumns[i]">
          <mat-option *ngFor="let col of aggregationData.columns[i]" [value]="col">{{col}}</mat-option>
        </mat-select>
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Function (Optional)</mat-label>
        <mat-select (selectionChange)="calculateFormula1(i)" [(ngModel)]="aggregationData.functions[i]">
          <mat-option *ngFor="let level of aggregationData.availableFunctions[i]" [value]="level">{{level}}</mat-option>
        </mat-select>
      </mat-form-field>
    </mat-grid-tile>


    <!-- <mat-grid-tile>
      <button mat-raised-button color="warn" (click)="deleteRow(1,i)" class="mr-4" *ngIf="!isFirst"
      [disabled]="!aggregationData.aggregationLevelColumns[i]">Delete</button>
    <button mat-raised-button color="primary" *ngIf="isLast" (click)="addRow(1)"
      [disabled]="!aggregationData.aggregationLevelColumns[i]">Add</button>
    </mat-grid-tile> -->
      <mat-grid-tile>
        <button mat-stroked-button mat-icon-button isRoundButton="true" aria-label="Add row" *ngIf="isLast"
          (click)="addRow(1)" [disabled]="!aggregationData.aggregationLevelColumns[i]"  style="position: relative;left: -15%;">
          <mat-icon>add</mat-icon>
        </button>
        <button mat-stroked-button mat-icon-button aria-label="Delete row" isRoundButton="true" (click)="deleteRow(1,i)"
          *ngIf="!isFirst" [disabled]="!aggregationData.aggregationLevelColumns[i]">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-grid-tile>

  </mat-grid-list>
</mat-card>

<!-- part 2a------------------------------------------- -->

<mat-card>
  <mat-grid-list cols="4" rowHeight="4:1"
    *ngFor="let item of aggregationsList; index as i; last as isLast; first as isFirst">

    <mat-grid-tile colspan="4">
      <form style="display: flex; flex-direction: column; height: 50%; width:100%">
        <mat-form-field class="stretch-height">
          <mat-label>Aggregation for numerical columns</mat-label>
          <textarea matInput rows="3" [formControl]="queryTextarea" (change)="calculateFormula(i)"
            (input)="inputValue($event.target.value,i)" [(ngModel)]="aggregationData.aggregations"
            [matAutocomplete]="auto"></textarea>
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelectionChanged($event)">
            <mat-optgroup *ngFor="let option of results " [label]="option.groupName">
              <mat-option *ngFor="let opt of option.values " [value]="opt">
                {{opt}}
              </mat-option>
            </mat-optgroup>
          </mat-autocomplete>
          <p *ngIf="isError">Bracket is required</p>
          <mat-error *ngIf="!queryTextarea.valid">Duplicate Formula!</mat-error>
        </mat-form-field>
      </form>
    </mat-grid-tile>
  </mat-grid-list>
</mat-card>

<button mat-button matStepperPrevious>Back</button>
<button mat-button matStepperNext (click)="apply()" class="float-right">Next</button>