<mat-card>
  <mat-accordion>
    <mat-expansion-panel style="margin-bottom: 15px;">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <b>Choose Existing conditions</b>
        </mat-panel-title>
        <mat-panel-description> </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-grid-list cols="2" rowHeight="30px" *ngIf="condition.length">
        <mat-grid-tile [colspan]="1">
          <mat-form-field style="width: 100%">
            <input matInput type="text" placeholder="Search for condition(s)" (input)="filterList($event.target.value)">
          </mat-form-field>
        </mat-grid-tile>
      </mat-grid-list>
      <section *ngFor="let item of condition">
        <mat-checkbox style="font-weight: normal;" id="{{item.condition_id}}" class="checkobox" [checked]="item.checked"
          (change)="onSelect(item.condition_name, item.condition_id, $event, item)">{{item.condition_name}}
        </mat-checkbox>
      <button class="mini-fab sideButtons" *ngIf="condition.length" title="Delete Permanently"
          (click)="deleteCondition(item.condition_id)">
          <i class="material-icons" style="color:#afafb5">
            delete
          </i>
        </button>
      </section>
      <p *ngIf="!condition.length" style="text-align: center;">No Data Available</p>
    </mat-expansion-panel>
  </mat-accordion>

  <mat-card>
    <mat-card-header>
      <b style="margin-left: -24px;">Define New Condition</b></mat-card-header>
    <table class="table">
      <thead style="width:100%;">
        <tr>
          <th class="text-center" *ngFor="let h of headers" scope="col">
            <b>{{h}}</b>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let con of createFormula;let i = index;">
          <td width="40%">
            <form style="display: flex; flex-direction: column; height: 50%;" #attributeForm="ngForm">
              <input matInput (input)="inputValue($event.target.value)" class="form-control inputFormula" id="attribute"
                [matAutocomplete]="autoAttr" [(ngModel)]="con.attribute" name="attribute">
              <mat-autocomplete #autoAttr="matAutocomplete" (optionSelected)="onSelectionChanged($event, con,'attribute')">
                <mat-optgroup *ngFor="let option of results " [label]="option.groupName"
                  [hidden]="!option['values'].length">
                  <mat-option *ngFor="let opt of option.values " [value]="opt">
                    {{opt}}
                  </mat-option>
                </mat-optgroup>
              </mat-autocomplete>
            </form>
          </td>
          <td width="10%">
            <select required class="dropdown" [(ngModel)]="con.condition">
              <option class="text-center" *ngFor="let x of conditionList" [ngValue]="x">{{x}}</option>
            </select>
          </td>
          <td width="40%">
            <form style="display: inline-block; flex-direction: column; height: 50%;width: 90%" #valueForm="ngForm">
              <input matInput (input)="inputValue($event.target.value)" class="form-control inputFormula" id="values"
                [matAutocomplete]="autoVal" [(ngModel)]="con.values" name="values">
              <mat-autocomplete #autoVal="matAutocomplete" (optionSelected)="onSelectionChanged($event, con, 'value' )">
                <mat-optgroup *ngFor="let option of results " [label]="option.groupName"
                  [hidden]="!option['values'].length">
                  <mat-option *ngFor="let op of option.values" [value]="op">
                    {{op}}
                  </mat-option>
                </mat-optgroup>
              </mat-autocomplete>
            </form>
            <div style="display:inline-block;">
              <input type="file" style="display: none;" accept=".xls,.xlsx" id="valueInput{{i}}"
                (change)="uploadFile($event,con,i)">
              <button class="sideButtons" (click)="triggerFileBtn(i)" style="margin-top:3px;" title="Upload excel with data in the First column">
                <svg style="width:24px;height:24px;" viewBox="0 0 24 24">
                  <path fill="#afafb5" d="M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z" />
                </svg>
              </button>
            </div> 
          </td>
          <td width="3%" style="border-width: 0px;">
            <select required class="dropdown" [(ngModel)]="con.operator">
              <option class="text-center" *ngFor="let x of operator" [ngValue]="x == '-'? '': x">{{x}}</option>
            </select>
          </td>
          <div style="display:inline-block">
            <button class="sideButtons" style="margin-left: -13px;" (click)="addColumn(con)" title="Add row">
              <i class="material-icons" style="color:#afafb5;font-size: 18px;">
                add_circle
              </i>
            </button>
            <button *ngIf="createFormula.length >= 2" class="sideButtons" title="Remove row"
              (click)="removeColumn(con)">
              <i class="material-icons" style="color:#afafb5;font-size: 18px;margin-left: -11px;">
                remove_circle
              </i>
            </button>
          </div>
        </tr>
      </tbody>
    </table>
  </mat-card>
  <mat-card>
    <form #saveForm="ngForm" style="display: flex; flex-direction: column; height: 50%;">
      <mat-form-field class="stretch-height">
        <mat-label>Save as</mat-label>
        <textarea matInput [(ngModel)]="columnName" name="columnName" required>
          <div [hidden]="columnName.valid || name.pristine"
     class="alert alert-danger">
</div>
        </textarea>
        <!-- <mat-error *ngIf="!columnName.valid">Required Field!</mat-error> -->
      </mat-form-field>
    </form>
  </mat-card>
</mat-card>
<button mat-button matStepperPrevious class="btn btn-primary">Back</button>
<button mat-button matStepperNext (click)="defineFormula()" [disabled]="requiredFields()" class="float-right btn btn-success">Add to Formula Bar</button>