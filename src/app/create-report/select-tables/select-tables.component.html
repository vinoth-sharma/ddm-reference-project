<mat-card>
  <mat-card-content>
    <form #selectedTablesForm="ngForm">
      <mat-grid-list cols="12" rowHeight="4:3"
        *ngFor="let selected of selectedTables; index as rowIndex; last as isLast; first as isFirst">
        <mat-grid-tile colspan="3" *ngIf="tables['tables'].length || tables['custom tables'].length">
          <mat-form-field>
            <mat-label>Select table/custom table</mat-label>
            <mat-select [(ngModel)]="selected.table" name="table-{{rowIndex}}"
              (selectionChange)="getRelatedTables(selected)" [disabled]="selected.disabled" required>
              <mat-optgroup label="Related Tables" [hidden]="!isRelated">
                <mat-option *ngFor="let table of tables['related tables']" [value]="table">
                  {{table.mapped_table_name | uppercase}}
                </mat-option>
              </mat-optgroup>
              <mat-optgroup label="Tables" *ngIf="tables['tables'].length">
                <mat-option *ngFor="let table of tables['tables']" [value]="table">
                  {{table.mapped_table_name | uppercase}}
                </mat-option>
              </mat-optgroup>
              <mat-optgroup label="Custom Tables" *ngIf="tables['custom tables'].length">
                <mat-option *ngFor="let table of tables['custom tables']" [value]="table">
                  {{table.custom_table_name | uppercase}}
                </mat-option>
              </mat-optgroup>
            </mat-select>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile colspan="3">
          <mat-form-field *ngIf="selected.table">
            <mat-label>Select Columns</mat-label>
            <mat-select multiple [(ngModel)]="selected['columns']" name="columns-{{rowIndex}}"
              (selectionChange)="onColumnSelect()">
              <mat-option *ngFor="let column of selected['table']['mapped_column_name']" [value]="column">
                {{column}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile colspan="3">
          <mat-form-field *ngIf="selected.table && selected['columns'].length && !isFirst">
            <mat-label>Select Join</mat-label>
            <mat-select [(ngModel)]="selected.join" name="join-{{rowIndex}}" (selectionChange)="setJoinData()"
              [disabled]="selected.disabled">
              <mat-option value="left">Left</mat-option>
              <mat-option value="right">Right</mat-option>
              <mat-option value="inner">Inner</mat-option>
              <mat-option value="outer">Outer</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-grid-tile>

        <mat-grid-tile colspan="1">
          <button mat-stroked-button mat-icon-button isRoundButton="true" aria-label="Add table" (click)="addRow()"
            *ngIf="selected.table && selected['columns'].length && isLast && (selectedTables.length < 2)">
            <mat-icon>add</mat-icon>
          </button>
        </mat-grid-tile>

        <mat-grid-tile colspan="1">
          <button mat-stroked-button mat-icon-button aria-label="Delete join" isRoundButton="true"
            (click)="deleteJoin(rowIndex)" *ngIf="selected.table && selected['columns'].length && isLast">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-grid-tile>

        <mat-grid-tile colspan="1">
          <button
            *ngIf="selected.table && selected['columns'].length && isLast && selected.join && !isFirst && joinData.length"
            mat-button color="primary">Set Join</button>
        </mat-grid-tile>

      </mat-grid-list>
    </form>
  </mat-card-content>
</mat-card>