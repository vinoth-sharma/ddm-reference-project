<mat-card>
  <mat-accordion>
    <mat-expansion-panel style="margin-bottom: 15px;">
      <mat-expansion-panel-header>
        <mat-panel-title style="font-weight: bold;">
          Existing Calculated Field List
        </mat-panel-title>
        <mat-panel-description> </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-grid-list cols="2" rowHeight="100px" *ngIf="originalExisting.length && !isExistingLoading">
        <mat-grid-tile [colspan]="1">
          <mat-form-field style="width: 100%">
            <input matInput [formControl]="queryField" placeholder="Search here" />
          </mat-form-field>
        </mat-grid-tile>
      </mat-grid-list>
      <div style="overflow: auto;height: auto;max-height: 200px;" *ngIf="existingList.length && !isExistingLoading">
        <section *ngFor="let item of existingList">
          <mat-checkbox id="{{item.calculated_field_id}}"
            class="checkobox"
            [checked]="item.checked"
            (change)="toggle(item,$event)">{{ item.calculated_field_name }}</mat-checkbox>
          <button mat-stroked-button mat-icon-button aria-label="Delete Field" isRoundButton="true" class="mini-fab"
          data-toggle="modal" data-target="#calculatedModal" (click)="fieldId = item.calculated_field_id"
          title="Delete Field">
          <mat-icon>delete</mat-icon>
        </button>
        </section>
      </div>
      <p *ngIf="!existingList.length && !isExistingLoading" style="text-align: center;">No Data Available</p>
      <div *ngIf="isExistingLoading" class="p-0"> 
        <mat-progress-spinner class="l-t-40" mode="indeterminate"></mat-progress-spinner>
      </div>
    </mat-expansion-panel>
  </mat-accordion>

  <mat-card>
    <p style="font-weight: bold">Create Calculated Field</p> 
    <mat-grid-list cols="2" rowHeight="100px">
      <mat-grid-tile [colspan]="1">
          
        <mat-form-field style="width: 100%">
          <!-- <input matInput [formControl]="columnName" placeholder="Column Name" [maxlength]="50" [required]="queryTextarea.value ? true : false"/> -->
          <input matInput [formControl]="columnName" placeholder="Column Name" [maxlength]="50"/>          
          <mat-error *ngIf="!columnName.valid">Duplicate Name!</mat-error>
        </mat-form-field>
      </mat-grid-tile>
      <mat-grid-tile>
            <button [disabled]=" !queryTextarea.value || !columnName.valid || !queryTextarea.valid" mat-stroked-button mat-icon-button isRoundButton="true" aria-label="Add Field" (click)="add()"
            >
            <mat-icon>add</mat-icon>
          </button>
      </mat-grid-tile>
    </mat-grid-list>

    <form style="display: flex; flex-direction: column; height: 50%;">
      <mat-form-field class="stretch-height">
          <!-- [required]="columnName.value ? true : false" -->
        <mat-label>Enter Formula</mat-label>
        <textarea id="cccId"
          matInput
          [formControl]="queryTextarea" (input)="inputValue($event, $event.target.value)"
          [matAutocomplete]="auto"
        ></textarea>
        <!-- [required]="!chips.length" -->
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelectionChanged($event)" >
            <mat-optgroup *ngFor="let option of suggestionList " [label]="option.groupName" [hidden]="!option['values'].length">
              <mat-option *ngFor="let opt of option.values" [value]="opt.formula">
                {{opt.name}}
              </mat-option>
            </mat-optgroup>
          </mat-autocomplete>
          <!-- <mat-error *ngIf="columnName.hasError('colName')">Can't be Table/Column Name!</mat-error> -->
          <!-- <mat-error *ngIf="queryTextarea.hasError('dupName')">Duplicate Name!</mat-error> -->
      </mat-form-field>
    </form>

    <!-- <mat-form-field> -->
    <mat-chip-list #chipList aria-label="">
      <mat-chip
        *ngFor="let chip of chips"
        [selectable]="selectable"
        [removable]="removable"
        (removed)="remove(chip)"
        (click)="getSelected(chip)">
        {{ chip.name }}
        <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
      </mat-chip>
    </mat-chip-list>
  </mat-card>
</mat-card>


<button mat-button matStepperPrevious class="btn btn-primary">Back</button>
<button mat-button matStepperNext (click)="next()" [disabled]="!chips.length ?  ((!columnName.value && !queryTextarea.value && !chips.length) || (columnName.value && !queryTextarea.value) || !columnName.valid || !queryTextarea.valid) : ((!columnName.value && !queryTextarea.value) || (columnName.value && !queryTextarea.value) || !columnName.valid || !queryTextarea.valid)" class="float-right btn btn-success">Add to Formula Bar</button>

<app-confirm-modal (confirm)="deleteField(fieldId)" [customId]="'calculatedModal'" [confirmText]="confirmText" [confirmHeader]="confirmHeader" ></app-confirm-modal>